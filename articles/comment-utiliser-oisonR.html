<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="fr">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="oisonR">
<title>Comment utiliser le package oisonR ? • oisonR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comment utiliser le package oisonR ?">
<meta property="og:description" content="oisonR">
<meta property="og:image" content="https://richaben.github.io/oisonR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Passer au contenu</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">oisonR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Activer la navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Référence</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/bien-demarrer-avec-oisonR.html">Bien démarrer avec le package oisonR</a>
    <a class="dropdown-item" href="../articles/comment-utiliser-oisonR.html">Comment utiliser le package oisonR ?</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Activer la navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Rechercher" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/richaben/oisonR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Comment utiliser le package oisonR ?</h1>
            
      
      <small class="dont-index">Source : <a href="https://github.com/richaben/oisonR/blob/HEAD/vignettes/comment-utiliser-oisonR.Rmd" class="external-link"><code>vignettes/comment-utiliser-oisonR.Rmd</code></a></small>
      <div class="d-none name"><code>comment-utiliser-oisonR.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="récupérer-les-données-via-laccès-à-la-base-sql">Récupérer les données via l’accès à la base SQL<a class="anchor" aria-label="anchor" href="#r%C3%A9cup%C3%A9rer-les-donn%C3%A9es-via-lacc%C3%A8s-%C3%A0-la-base-sql"></a>
</h2>
<div class="section level3">
<h3 id="chargement-des-packages">Chargement des packages<a class="anchor" aria-label="anchor" href="#chargement-des-packages"></a>
</h3>
<p>Quelques packages sont nécessaires pour exécuter les exemples
ci-dessous.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/richaben/oisonR" class="external-link">oisonR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co"># devtools::install_github("MaelTheuliere/COGiter")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MaelTheuliere/COGiter" class="external-link">COGiter</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="les-observations-taxons">Les observations taxons<a class="anchor" aria-label="anchor" href="#les-observations-taxons"></a>
</h3>
<p>Les <em>observations taxons</em> de OISON sont récupérables avec la
fonction <code><a href="../reference/get_table_taxon_sql.html">get_table_taxon_sql()</a></code>. Avant son utilisation, il
faut toutefois :</p>
<ul>
<li>s’assurer de disposer des paramètres de connexion à la base SQL
(<em>cf</em>. la vignette <code>oisonR</code> pour plus de détails)
;</li>
<li>puis, initier la connexion à la base de données avec la fonction
<code>init_connexion_sql()</code>.</li>
</ul>
<p>La fonction permet de récupérer l’ensemble des observations de la
base, sauf si une géométrie est précisée en argument (argument
<code>geometrie</code> dans la fonction).</p>
<p>Après récupération des données, il est conseillé de stopper la
connexion à la base avec la fonction
<code><a href="../reference/stop_sql_connexion.html">stop_sql_connexion()</a></code>.</p>
<div class="section level4">
<h4 id="exemple-pour-réaliser-un-export-des-observations-taxons-sur-les-écrevisses-en-bretagne-pour-lannée-2023">Exemple pour réaliser un export des observations taxons sur les
écrevisses en Bretagne pour l’année 2023<a class="anchor" aria-label="anchor" href="#exemple-pour-r%C3%A9aliser-un-export-des-observations-taxons-sur-les-%C3%A9crevisses-en-bretagne-pour-lann%C3%A9e-2023"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Création d’une géométrie pour la Bretagne</li>
</ol>
<p>Le package R <code>COGiter</code> peut être utilisé pour créer
récupérer la géométrie de la région et la convertir ensuite en chaîne de
caractères qui sera utilisée pour effectuer la requête.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geom_BZH</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">COGiter</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/COGiter/man/regions_geo_xx.html" class="external-link">regions_geo</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># filtre sur BZH</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">REG</span> <span class="op">==</span> <span class="fl">53</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># convert to text</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_text.html" class="external-link">st_as_text</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Le début de la géométrie ressemble à cela : MULTIPOLYGON (((267337.9
6730985, 269412.2 6732332, 269637.9 6734259, 270864.3 6735502, 270508.8
673…..</p>
<ol start="2" style="list-style-type: decimal">
<li>Récupération des données <em>observations taxons</em>
</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a) connexion</span></span>
<span><span class="va">bdd_oison</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/start_sql_connexion.html">start_sql_connexion</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># b) requete</span></span>
<span><span class="va">oison_BZH</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/get_table_taxon_sql.html">get_table_taxon_sql</a></span><span class="op">(</span>conn <span class="op">=</span> <span class="va">bdd_oison</span>,</span>
<span>                      geometrie <span class="op">=</span> <span class="va">geom_BZH</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># d) stop de la connexion</span></span>
<span><span class="fu"><a href="../reference/stop_sql_connexion.html">stop_sql_connexion</a></span><span class="op">(</span>conn <span class="op">=</span> <span class="va">bdd_oison</span><span class="op">)</span></span></code></pre></div>
<p>Le résultat de la requête est un objet de type
<code>data.frame</code>. Les noms de colonnes peuvent être obtenus de la
façon suivante :</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oison_BZH</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>⚠️ <strong>A noter</strong> que certains champs de données présents
dans les exports via l’application OISON ne sont pas présents dans ces
exports avec ce package. Il s’agit ici d’une vue simplifiée et
utilisable directement.</p>
</blockquote>
<ol start="3" style="list-style-type: decimal">
<li>Filtrage des données</li>
</ol>
<p>Pour extraire les observations taxons correspondant aux écrevisses
observées en 2023, il suffit de réaliser un filtrage à partir (i) de la
colonne <code>nom_vernaculaire</code> et (ii) de la nouvelle colonne
<code>annee</code> (créée à partir colonne <code>date</code>) :</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oison_BZH_ecrevisse_2023</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">oison_BZH</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># detection pattern 'creviss' et filtre</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'creviss'</span>, <span class="va">nom_vernaculaire</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># création colonne annee</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>annee <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">date</span>, <span class="st">'%Y'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># filtre sur annee 2023</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">annee</span> <span class="op">==</span> <span class="fl">2023</span><span class="op">)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Visualisation des données</li>
</ol>
<p>Pour une réutilisation en analyse spatiale, la colonne
<code>geometry</code> doit être convertie au format <code>sf</code>
(<em>simple features</em>) avec la fonction <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf()</a></code> du
package <code>sf</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oison_BZH_ecrevisse_2023_sf</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">oison_BZH_ecrevisse_2023</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Avec cet objet, les visualisations interactives sont possibles (<em>à
noter que dans l’exemple ci-dessous il ne s’agit pas des vraies données…
floutage !</em> 🕶) avec le package <code>mapview</code> :</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oison_BZH_ecrevisse_2023_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Export des données</li>
</ol>
<p>L’export sous différents formats est possible, dont le format
<em>geopackage</em> <code>gpkg</code> pour une réutilisation sous SIG.
&gt; Le format <code>gpkg</code> permet de conserver dans le même objet
les différents types de géométries pouvant se retrouver dans OISON
(points, polygones, lignes, …).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">write_sf</a></span><span class="op">(</span><span class="va">oison_BZH_ecrevisse_2023_sf</span>, </span>
<span>             <span class="st">"D:/oison_BZH_ecrevisse_2023.gpkg"</span>, </span>
<span>             driver <span class="op">=</span> <span class="st">"GPKG"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="les-observations-milieu">Les observations milieu<a class="anchor" aria-label="anchor" href="#les-observations-milieu"></a>
</h3>
<p>TO COMPLETE… 🛠</p>
</div>
</div>
<div class="section level2">
<h2 id="récupérer-les-données-via-lapi">Récupérer les données via l’API<a class="anchor" aria-label="anchor" href="#r%C3%A9cup%C3%A9rer-les-donn%C3%A9es-via-lapi"></a>
</h2>
<p>TO COMPLETE… 🛠</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>Sur cette page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Développé par Benoit Richard.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site créé avec <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
