---
title: "1. Bien dÃ©marrer avec le package oisonR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{1. Bien dÃ©marrer avec le package oisonR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

### Pourquoi un package `oisonR` ?

Ce package a Ã©tÃ© dÃ©veloppÃ© pour faciliter lâ€™accÃ¨s aux donnÃ©es bancarisÃ©es dans [OISON](https://oison.ofb.fr/), et ainsi permettre leur rÃ©-utilisation dans le cadre de projets de valorisation (tÃ©lÃ©chargement des donnÃ©es et mises en formes dans des formats exploitables).

#### Installation et chargement

```{r installation, eval=FALSE}
# install.packages("devtools")
devtools::install_github("richaben/oisonR", build_vignettes = TRUE)

# Chargement
library(oisonR)
```

#### PrÃ©requis pour l'utilisation du package

Avec ce package, l'accÃ¨s aux donnÃ©es [OISON](https://oison.ofb.fr/) peut se faire via deux sources possibles :

-   par une connexion directe Ã  l'application (via une API) nÃ©cessitant un accÃ¨s `login`/`mot de passe`. Par ce moyen, ce sont les donnÃ©es en temps rÃ©el qui peuvent Ãªtre obtenues ; mais elles sont tÃ©lÃ©chargÃ©es plus lentement (*requÃªte limitÃ©e en nombre de lignes*).

-   par la base de donnÃ©es SQL. Cela nÃ©cessite d'obtenir les paramÃ¨tres de connexion Ã  la base au prÃ©alable, et une connexion au rÃ©seau interne de l'OFB (ou au VPN). Par ce moyen, les donnÃ©es accessibles sont datÃ©es Ã  J-1 sur une copie de la base (*en lecture seule*). Ici, un volume important de donnÃ©es peut Ãªtre tÃ©lÃ©chargÃ© (*plus rapidement que par l'API*).

> ðŸ’¡ *Certaines fonctions exigent des paramÃ¨tres particuliers pour l'accÃ¨s aux donnÃ©es (par exemple login, mot de passe, etc...). Pour ne pas saisir ces paramÃ¨tres Ã  chaque utilisation, il est conseillÃ© de les stocker directement dans lâ€™environnement `R`* (*cf. procÃ©dure ci-dessous*).

Deux fonctions utiles sont disponibles pour vÃ©rifier si les informations de connexion sont bien sauvegardÃ©es et stockÃ©es dans l'environnement `R` de l'utilisateur:

```{r, echo = TRUE, eval = FALSE}
## pour vÃ©rifier les Ã©lÃ©ments de connexion via l'api
check_acces_oison_api()

## pour vÃ©rifier les Ã©lÃ©ments de connexion via la connexion SQL
check_acces_oison_sql()
```

#### Marche Ã  suivre pour stocker des informations dans l'environnement `R`

âš  *Il faut bien renseigner les informations dans l'environnement* `R` *avec le mÃªme nom que ci-dessous pour que ces Ã©lÃ©ments soient vÃ©rifiables et utilisables par les fonctions* `check_acces_oison_***()`.

1.  Connexion via l'API

```{r, echo = TRUE, eval = FALSE}
## 1Â° - ouvrir le fichier de configuration de l'environnement R avec la fonction :
usethis::edit_r_environ()

## 2Â° - dans la fenÃªtre ouverte intitulÃ©e '.Renviron', 
# sauvegarder les lignes suivantes correspondant aux identifiants
OISON_ID = "john.doe@ofb.gouv.fr"
OISON_PASSWORD = "moncodesecret"

## 3Â° - dans les fonctions, ces informations peuvent Ãªtre utilisÃ©es avec les 
## lignes suivantes (Ã  la place des 'vrais' identifiants) :
Sys.getenv('OISON_ID')
Sys.getenv('OISON_PASSWORD')
```

2.  Connexion via la base SQL

âš  *Requiert d'avoir la bonne configuration (les bons paramÃ¨tres)*

```{r, echo = TRUE, eval = FALSE}
## 1Â° - ouvrir le fichier de configuration de l'environnement R avec la fonction :
usethis::edit_r_environ()

## 2Â° - dans la fenÃªtre ouverte intitulÃ©e '.Renviron', 
# sauvegarder les lignes suivantes avec le bon paramÃ©trage
OISON_BDname = 'NOM_DE_LA_BDD'
OISON_BDhostname = "URL_DE_LA_BDD"
OISON_BDport = "LE_PORT_DE_LA_BDD"
OISON_BDuid = "IDENTIFIANT_DE_CONNEXION_A_LA_BDD"
OISON_BDpwd = "MOT_DE_PASSE_DE_CONNEXION_A_LA_BDD"

## 3Â° - dans les fonctions, ces informations doivent Ãªtre utilisÃ©es avec les
## lignes suivantes :
Sys.getenv('OISON_BDname')
Sys.getenv('OISON_BDhostname')
Sys.getenv('OISON_BDport')
Sys.getenv('OISON_BDuid')
Sys.getenv('OISON_BDpwd')
```



